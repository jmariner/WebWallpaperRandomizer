!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cronr=t():e.Cronr=t()}(window,function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=14)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(8),r=s(7),i=s(6),o=s(5),a=s(2);t.default={min:n.default,toNum:o.default,isLeap:r.default,sortByValue:i.default,resolveTsParts:a.default}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0),{isLeap:r}=n.default;t.units=["milliSecond","second","minute","hour","day","month","weekday"];const i=[31,28,31,30,31,30,31,31,30,31,30,31],o=[31,29,31,30,31,30,31,31,30,31,30,31];let a=Object.create(null);const u=1e3;class l{constructor(e){const{unit:t,value:s,step:n,max:r,min:i,order:o,setCallee:a,affiliatedMax:u}=e;this.unit=t,this.value=s,this.max=r,this.min=i,this.order=o,this.step=n,this.setCallee=a,this.affiliatedMax=u}static instance(e){return l.create(e)}static create(e){return l.getInstance(e)}static getDayMax({month:e,year:t}){return r(t)?o[e]:i[e]}static getInstance(e){if(!a[e]){const s={unit:e,order:t.units.indexOf(e)+1};let n=void 0;switch(e){case"milliSecond":n={min:0,max:999,step:1,value:1,setCallee:"setMilliseconds"};break;case"second":n={min:0,max:59,step:1*u,value:1*u,setCallee:"setSeconds"};break;case"minute":n={min:0,max:59,step:60*u,value:60*u,setCallee:"setMinutes"};break;case"hour":n={min:0,max:23,step:3600*u,value:3600*u,setCallee:"setHours"};break;case"day":n={min:1,max:l.getDayMax,step:86400*u,value:86400*u,setCallee:"setDate"};break;case"weekday":n={min:1,max:7,affiliatedMax:l.getDayMax,step:86400*u,value:void 0,setCallee:"setDate"};break;case"month":n={min:0,max:11,step:86400*u,value:void 0,setCallee:"setMonth"}}a[e]=new l(Object.assign({},n,s))}return a[e]}}t.default=l},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>({milliSecond:e.getMilliseconds(),second:e.getSeconds(),minute:e.getMinutes(),hour:e.getHours(),day:e.getDate(),month:e.getMonth(),weekday:0===e.getDay()?7:e.getDay()}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LITERAL="literal",t.RANGE="range",t.EVERY="every"},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3),r=s(1),i=e=>"number"==typeof e,o=e=>h.indexOf(e),a=e=>d.indexOf(e),u=e=>parseInt(e),l=e=>e.charAt(0).toUpperCase()+e.toLowerCase().slice(1,3),c=e=>e.replace(/[a-zA-Z]+/g,l),h=[,"Mon","Tue","Wed","Thu","Fri","Sat","Sun"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function f(e){return t=>{for(let s of e){if(s.test(t))return E[s.source](t)}throw new Error("no match patterns")}}const m=e=>t=>e.reduce((e,t)=>t(e),t),p=Object.create(null);p.month=m([c,e=>e.replace(/[0-9]+/g,e=>`${parseInt(e)-1}`)]),p.weekday=m([c]);const y=/^(\d{1,2})$/,v=/^(\d{1,2})$/,T=/^(\d+)-(\d+)$/,k=/^(\*)(?:\/([0-9]*))?$/,b=/^(\d{1,2})\/([0-9]*)$/,g=/^(\d+)-(\d+)\/([0-9]*)$/,O=RegExp(`^(${h.join("|")})(?:-(${h.join("|")}))?$`),w=RegExp(`^(${d.join("|")})(?:-(${d.join("|")}))?$`),x=Object.create(null);x.milliSecond=f([v,T,k,g]),x.second=f([y,T,k,g]),x.minute=f([y,T,k,g]),x.hour=f([y,T,k,g]),x.day=f([y,T,k,g]),x.month=f([y,T,k,g,w]),x.weekday=f([y,T,k,g,O]);const E=Object.create(null),j=e=>e.source;E[j(y)]=(e=>{const t=y.exec(e);if(t){const[,e]=t;return{type:n.LITERAL,value:u(e)}}return null}),E[j(v)]=(e=>{const t=v.exec(e);if(t){const[,e]=t;return{type:n.LITERAL,value:u(e)}}return null}),E[j(T)]=(e=>{const t=T.exec(e);if(t){const[,e,s]=t;return{type:n.RANGE,value:{from:u(e),to:u(s)}}}return null}),E[j(k)]=(e=>{const t=k.exec(e);if(t){const[,,e]=t;return e?{type:n.EVERY,value:u(e)}:{type:n.EVERY,value:1}}}),E[j(b)]=(e=>{const t=b.exec(e);if(t){const[,e,s]=t;return[{type:n.EVERY,value:u(s)},{type:n.RANGE,value:{from:u(e)}}]}}),E[j(g)]=(e=>{const t=g.exec(e);if(t){const[,e,s,r]=t;return[{type:n.EVERY,value:u(r)},{type:n.RANGE,value:{from:u(e),to:u(s)}}]}return[]}),E[j(O)]=(e=>{const t=c(e),s=O.exec(t);if(s){const[,e,t]=s;return t?{type:n.RANGE,value:{from:o(e),to:o(t)}}:{type:n.LITERAL,value:o(e)}}}),E[j(w)]=(e=>{const t=c(e),s=w.exec(t);if(s){const[,e,t]=s;return t?{type:n.RANGE,value:{from:a(e),to:a(t)}}:{type:n.LITERAL,value:a(e)}}});const M=(e,t,s)=>s>e?e:s<t?t:s,V=e=>t=>{const s=r.default.getInstance(e),{max:o,min:a}=s;return i(o)&&i(a)?t.map(e=>{switch(e.type){case n.LITERAL:return Object.assign({},e,{value:M(o,a,e.value)});case n.RANGE:return Object.assign({},e,{value:((e,t,s)=>{const{from:n,to:r}=s;return{from:M(e,t,n),to:M(e,t,r)}})(o,a,e.value)});case n.EVERY:return Object.assign({},e)}}):t},C=Object.create(null);C.milliSecond=m([V("milliSecond")]),C.second=m([V("second")]),C.minute=m([V("minute")]),C.hour=m([V("hour")]),C.month=m([V("month")]),C.weekday=m([e=>e.map(e=>{switch(e.type){case n.LITERAL:const t=e.value;return Object.assign({},e,{value:0===t?7:t});case n.RANGE:const s=e.value;return 0===s.from&&6===s.to?Object.assign({},e,{value:{from:1,to:7}}):Object.assign({},e);case n.EVERY:return Object.assign({},e)}}),V("weekday")]),t.parse=function(e,t){return e.split(",").reduce((e,s)=>{const n=x[t];let r=s;p[t]&&(r=p[t](s));let i=n(r);return C[t]&&(i=C[t]([].concat(i))),e.concat(i)},[])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=(e=>e.valueOf())},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=((e,t)=>{const{value:s}=e,{value:n}=t;return s-n})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>!(!(e%4)||e%100||e%400))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=(e=>e.reduce((e,t)=>t?void 0!==e?Math.min(e,t):t:e))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),r=s(3),i=s(0),o=s(2),a=s(4),{toNum:u}=i.default;class l{constructor(e,t){this.pattern=e,this.unit=t}static create(e,t){return new l(e,t)}resolvedOptions(){return this.resolvedOptionsCache||(this.resolvedOptionsCache=n.default.instance(this.unit)),this.resolvedOptionsCache}matchToken(e,t){const s=this.formatToParts(),n=s.filter(e=>e.type===r.LITERAL),i=s.filter(e=>e.type===r.EVERY);let o=s.filter(e=>e.type===r.RANGE);for(let t of n){const{value:s}=t;if(s===e)return!0}let a=1;i.length>0&&(a=i[0].value);const{min:u,max:l}=this.resolvedOptions();let c=l;"function"==typeof l&&t&&(c=l(t)),0===o.length&&i.length>0&&(o=[{type:r.RANGE,value:{from:u,to:c}}]);for(let t of o){const s=t.value.from||u,n=t.value.to||c;for(let t=s;t<=n;t+=a)if(e===t)return!0}return!1}findTheClosestValidValue(e,t){const{max:s,min:n}=this.resolvedOptions(),r=o.default(t);let i=s;if("function"==typeof i){t.getFullYear(),t.getMonth();i=i(r)}for(let t=e;t>=n&&t<=i;t++)if(this.matchToken(t,r))return t;throw new Error("Maybe you should carry over the number, then match again")}findTheClosestValidValueForWeekday(e,t){const{affiliatedMax:s,min:n}=this.resolvedOptions(),r=o.default(t),i=new Date(u(t));if(!s)return;t.getFullYear(),t.getMonth();const a=s(r);for(let t=e;t>=n&&t<=a;){const{weekday:e}=o.default(i);if(this.matchToken(e,r))return t;t++,i.setDate(t)}throw new Error("Maybe you should carry over the number, then match again")}formatToParts(){return this.formatToPartsCache||(this.formatToPartsCache=a.parse(this.pattern,this.unit)),this.formatToPartsCache}}t.default=l},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(9),r=s(1),i=Symbol("millisecond_base"),o=Symbol("second_based"),a=Symbol("minute_base");class u{constructor(e){this.milliSecondToken=Object.create(null),this.secondToken=Object.create(null),this.minuteToken=Object.create(null),this.hourToken=Object.create(null),this.dayToken=Object.create(null),this.monthToken=Object.create(null),this.weekdayToken=Object.create(null),this.pattern=e,this.type=i}static create(e){const t=new u(e);return t.initToken(),t}patternParts(){return this.pattern.split(" ")}resolveStep(){const e=this.fullPatternParts.length;let t=0;for(;t<e&&"*"===this.fullPatternParts[t];t++);if(t!==e){return this[`${r.units[t]}Token`].resolvedOptions().step}switch(this.type){case i:return 1;case o:return 1e3;case a:return 6e4;default:return 1}}initToken(){let e=this.patternParts();const t=e.length;if(t<5||t>7)throw new Error("Invalid pattern");5===t&&(e=["*","*"].concat(e),this.type=a),6===t&&(e=["*"].concat(e),this.type=o),this.fullPatternParts=e,e.forEach((e,t)=>this[`${r.units[t]}Token`]=n.default.create(e,r.units[t]))}}t.default=u},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(10),r=s(0),i=s(1),o=s(2),{min:a,toNum:u}=r.default;t.default=class{constructor(e){const{pattern:t,ts:s}=e,r=n.default.create(t),{milliSecondToken:i,secondToken:o,minuteToken:a,hourToken:l,dayToken:c,monthToken:h,weekdayToken:d}=r;this.pattern=r,this.milliSecondToken=i,this.secondToken=o,this.minuteToken=a,this.hourToken=l,this.dayToken=c,this.monthToken=h,this.weekdayToken=d,this.originTs=s||new Date,this.ts=new Date(u(this.originTs)),this.nextTs=void 0}[Symbol.iterator](){return{next:()=>{this.prevTs=new Date(u(this.ts));const e=this.nextTimeToCall(),t=this.pattern.resolveStep();return this.ts=new Date(u(e)+t),{value:e,done:!1}}}}nextTimeToCall(){const e=i.units.length;return this.traverse(i.units[e-2],this.ts),this.ts}normalizeTsValueAfterUnit(e,t,s){const n=i.units.indexOf(e);let r=n;s&&(r=n+1);for(let e=0;e<r;e++){const s=i.units[e],n=this.getTokenByUnit(s).resolvedOptions(),{setCallee:r,min:o}=n;t[r](o)}}decorateTsWithClosestValidValueAfterUnit(e,t,s){const n=i.units.indexOf(e);let r=n;s&&(r=n+1);for(let e=0;e<r;e++){const s=i.units[e],n=this.getTokenByUnit(s),r=o.default(t)[s],a=n.findTheClosestValidValue(r,t),u=n.resolvedOptions(),{setCallee:l}=u;t[l](a)}}traverse(e,t){const s=i.units.indexOf(e),n=this.getTokenByUnit(e),r=o.default(t),a=r[e];if(!this.checkIfTokenMatchsValue(n,a,r))try{const o=this.findTokenClosestValidValue(n,a,t),{setCallee:u}=n.resolvedOptions();return t[u](o),this.normalizeTsValueAfterUnit(e,t),void this.decorateTsWithClosestValidValueAfterUnit(e,t)}catch(n){if("month"!==e){const e=i.units[s+1],n=this.getTokenByUnit(e),{setCallee:o}=n.resolvedOptions(),a=r[e];t[o](a+1),this.normalizeTsValueAfterUnit(e,t),this.traverse(e,t)}else{const s=t.getFullYear();t.setFullYear(s+1),this.normalizeTsValueAfterUnit(e,t,!0),this.decorateTsWithClosestValidValueAfterUnit(e,t,!0)}return}s>0&&this.traverse(i.units[s-1],t)}checkIfTokenMatchsValue(e,t,s){if("day"!==e.unit)return e.matchToken(t,s);const n=this.getTokenByUnit("weekday"),r=e.pattern,i=n.pattern;if("*"===i&&"*"===r)return!0;const o=e.matchToken(t,s),a=n.matchToken(s.weekday,s);return"*"===i&&"*"!==r?o:"*"!==i&&"*"===r?a:o||a}findTokenClosestValidValue(e,t,s){if("day"!==e.unit)return e.findTheClosestValidValue(t,s);const n=o.default(s),r=this.getTokenByUnit("weekday"),i=e.pattern,a=r.pattern;if("*"===a&&"*"===i)return t;e.matchToken(t,n),r.matchToken(n.weekday,n);let u=void 0,l=void 0;try{u=e.findTheClosestValidValue(t,s)}catch(e){if("*"===a&&"*"!==i)throw e}if("*"===a&&"*"!==i)return u;try{l=r.findTheClosestValidValueForWeekday(t,s)}catch(e){if("*"!==a&&"*"===i)throw e}if("*"!==a&&"*"===i)return l;if(u&&l)return Math.min(u,l);throw new Error("Carry over to fetch again")}getTokenByUnit(e){return this[`${e}Token`]}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(11);t.default=class{constructor(e){const{name:t,pattern:s,ts:r}=e;this.name=t,this.resolver=new n.default({pattern:s,ts:r}),this.result=this.resolver[Symbol.iterator]()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(12),r=s(0),{toNum:i}=r.default,o="initial",a="running",u="suspend",l="clear";t.default=class{constructor(e,t,s={immediate:!1,startTime:new Date}){this.pattern=e,this.cb=t;const{startTime:r,immediate:i}=s;this.counter=new n.default({pattern:this.pattern,ts:r}),this.iterator=this.counter.result,this.immediate=i,this.status=o,this.endTime=s.endTime}resolveNextValidAction(e){switch(e){case o:return["start"];case a:return["stop","clear"];case u:return["clear","resume"];case l:return["restart"]}}start(e){if(this.status!==o)throw new Error(this.msg(this.status));!e&&this.immediate&&this.cb.call(null);const t=new Date;let s=this.iterator.next().value;for(;s<t;)s=this.iterator.next().value;let n=i(s)-i(t);0===n&&this.immediate&&(s=this.iterator.next().value,n=i(s)-i(t)),this.nextTick=s;const r=()=>{const e=this.iterator.next().value;if(!this.endTime||this.endTime>e){const t=i(e)-i(new Date);this.nextTick=e,this.timeoutId=setTimeout(r,t)}this.cb.call(this)};this.timeoutId=setTimeout(r,n),this.status=a}msg(e){return`Current status is '${e}', `+`you can only do ${JSON.stringify(this.resolveNextValidAction(e))} action`}stop(){if(this.status!==a)throw new Error(this.msg(this.status));clearTimeout(this.timeoutId),this.status=u}clear(){if(this.status!==a&&this.status!==u)throw new Error(this.msg(this.status));clearTimeout(this.timeoutId),this.status=l}restart(){if(this.status!==l)throw new Error(this.msg(this.status));this.status=o,this.start()}resume(){if(this.status!==u)throw new Error(this.msg(this.status));this.status=o,this.start(!0)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(13);t.default=n.default}])});